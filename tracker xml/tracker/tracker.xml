<system>
<keyword>note</keyword>
	<indexing_tag>description</indexing_tag><symbol>:</symbol> <string>&quot;A default business model.&quot;</string>
	<indexing_tag>author</indexing_tag><symbol>:</symbol> <string>&quot;Andres Rojas and Victor Vavan&quot;</string>

<keyword>class</keyword> 
	<class><location>../tracker/tracker.xml</location>TRACKER</class>

<keyword>inherit</keyword>
	<class><include>False</include>ANY</class>
		<keyword>redefine</keyword>
			<feature><location>../tracker/tracker.xml#f_out</location>out</feature>
		<keyword>end</keyword>

<keyword>create</keyword> <symbol>{</symbol><class><location>../tracker/tracker_access.xml</location>TRACKER_ACCESS</class><symbol>}</symbol>
	<feature><location>../tracker/tracker.xml#f_make</location>make</feature>

<keyword>feature</keyword> <symbol>{</symbol>NONE<symbol>}</symbol> <comment>--</comment><comment> Initialization</comment>

	<anchor>f_make</anchor><feature><location>../tracker/tracker.xml#f_make</location>make</feature>
			<comment>--</comment><comment> Initialization for </comment><quoted>Current</quoted><comment>.</comment>
		<keyword>local</keyword>
			<local>list</local><symbol>:</symbol> <class><include>False</include>STRING_TABLE</class> <symbol>[</symbol><class><location>../tracker/phase.xml</location>PHASE</class><symbol>]</symbol>
			<local>zero</local><symbol>:</symbol> <class><location>../mathmodels/value.xml</location>VALUE</class>
			<local>er_msg</local><symbol>:</symbol> <class><location>../tracker/messages_access.xml</location>MESSAGES_ACCESS</class>
			<local>nt</local><symbol>:</symbol> <class><location>../tracker/new_tracker.xml</location>NEW_TRACKER</class>
		<keyword>do</keyword>
			<keyword>create</keyword> <local>zero</local><dot>.</dot><feature><location>../mathmodels/value.xml#f_make_from_int</location>make_from_int</feature><symbol> </symbol><symbol>(</symbol><number>0</number><symbol>)</symbol>
			<keyword>create</keyword> <local>list</local><dot>.</dot><feature><include>False</include>make_equal_caseless</feature><symbol> </symbol><symbol>(</symbol><number>10</number><symbol>)</symbol>
			<keyword>create</keyword> <feature><location>../tracker/tracker.xml#f_sorted_phases</location>sorted_phases</feature><dot>.</dot><feature><include>False</include>make</feature>
			<keyword>create</keyword> <feature><location>../tracker/tracker.xml#f_sorted_conts</location>sorted_conts</feature><dot>.</dot><feature><include>False</include>make</feature>
			<feature><location>../tracker/tracker.xml#f_phases</location>phases</feature> <symbol>:=</symbol> <local>list</local>
			<feature><location>../tracker/tracker.xml#f_error</location>error</feature> <symbol>:=</symbol> <local>er_msg</local><dot>.</dot><feature><location>../tracker/messages_access.xml#f_ok</location>Ok</feature>
			<feature><location>../tracker/tracker.xml#f_active</location>active</feature> <symbol>:=</symbol> <keyword>False</keyword>
			<feature><location>../tracker/tracker.xml#f_state</location>state</feature> <symbol>:=</symbol> <number>0</number>
			<feature><location>../tracker/tracker.xml#f_cursor_state</location>cursor_state</feature> <symbol>:=</symbol> <number>0</number>
			<feature><location>../tracker/tracker.xml#f_max_phase_rad</location>max_phase_rad</feature> <symbol>:=</symbol> <local>zero</local>
			<feature><location>../tracker/tracker.xml#f_max_cont_rad</location>max_cont_rad</feature> <symbol>:=</symbol> <local>zero</local>
			<keyword>create</keyword> <feature><location>../tracker/tracker.xml#f_history</location>history</feature><dot>.</dot><feature><location>../tracker/history.xml#f_make</location>make</feature>
			<keyword>create</keyword> <local>nt</local><dot>.</dot><feature><location>../tracker/new_tracker.xml#f_make_init</location>make_init</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_max_phase_rad</location>max_phase_rad</feature><symbol>,</symbol> <feature><location>../tracker/tracker.xml#f_max_cont_rad</location>max_cont_rad</feature><symbol>)</symbol>
			<feature><location>../tracker/tracker.xml#f_history</location>history</feature><dot>.</dot><feature><location>../tracker/history.xml#f_add_to_record</location>add_to_record</feature><symbol> </symbol><symbol>(</symbol><local>nt</local><symbol>)</symbol>
		<keyword>end</keyword>
	
<keyword>feature</keyword> <symbol>{</symbol><class><location>../tracker/tracker.xml</location>TRACKER</class><symbol>}</symbol> <comment>--</comment><comment> model attributes</comment>

	<anchor>f_phases</anchor><feature><location>../tracker/tracker.xml#f_phases</location>phases</feature><symbol>:</symbol> <class><include>False</include>STRING_TABLE</class> <symbol>[</symbol><class><location>../tracker/phase.xml</location>PHASE</class><symbol>]</symbol>

	<anchor>f_sorted_phases</anchor><feature><location>../tracker/tracker.xml#f_sorted_phases</location>sorted_phases</feature><symbol>:</symbol> <class><include>False</include>SORTED_TWO_WAY_LIST</class> <symbol>[</symbol><class><location>../tracker/phase.xml</location>PHASE</class><symbol>]</symbol>

	<anchor>f_sorted_conts</anchor><feature><location>../tracker/tracker.xml#f_sorted_conts</location>sorted_conts</feature><symbol>:</symbol> <class><include>False</include>SORTED_TWO_WAY_LIST</class> <symbol>[</symbol><class><location>../tracker/phase_container.xml</location>PHASE_CONTAINER</class><symbol>]</symbol>

	<anchor>f_error</anchor><feature><location>../tracker/tracker.xml#f_error</location>error</feature><symbol>:</symbol> <class><include>False</include>STRING_8</class>

	<anchor>f_active</anchor><feature><location>../tracker/tracker.xml#f_active</location>active</feature><symbol>:</symbol> <class><include>False</include>BOOLEAN</class>

	<anchor>f_max_phase_rad</anchor><feature><location>../tracker/tracker.xml#f_max_phase_rad</location>max_phase_rad</feature><symbol>:</symbol> <class><location>../mathmodels/value.xml</location>VALUE</class>

	<anchor>f_max_cont_rad</anchor><feature><location>../tracker/tracker.xml#f_max_cont_rad</location>max_cont_rad</feature><symbol>:</symbol> <class><location>../mathmodels/value.xml</location>VALUE</class>

	<anchor>f_state</anchor><feature><location>../tracker/tracker.xml#f_state</location>state</feature><symbol>:</symbol> <class><include>False</include>INTEGER_32</class>

	<anchor>f_cursor_state</anchor><feature><location>../tracker/tracker.xml#f_cursor_state</location>cursor_state</feature><symbol>:</symbol> <class><include>False</include>INTEGER_32</class>

	<anchor>f_history</anchor><feature><location>../tracker/tracker.xml#f_history</location>history</feature><symbol>:</symbol> <class><location>../tracker/history.xml</location>HISTORY</class>

	<anchor>f_msg</anchor><feature><location>../tracker/tracker.xml#f_msg</location>msg</feature><symbol>:</symbol> <class><location>../tracker/messages_access.xml</location>MESSAGES_ACCESS</class>
	
<keyword>feature</keyword> <comment>--</comment><comment> model operations</comment>

	<anchor>f_new_phase</anchor><feature><location>../tracker/tracker.xml#f_new_phase</location>new_phase</feature> <symbol>(</symbol><local>pid</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>;</symbol> <local>phase_name</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>;</symbol> <local>capacity</local><symbol>:</symbol> <class><include>False</include>INTEGER_64</class><symbol>;</symbol> <local>expected_materials</local><symbol>:</symbol> <class><include>False</include>ARRAY</class> <symbol>[</symbol><class><include>False</include>INTEGER_64</class><symbol>]</symbol><symbol>)</symbol>
		<keyword>require</keyword>
			<tag>valid_pid</tag><symbol>:</symbol> <feature><location>../tracker/tracker.xml#f_valid_string</location>valid_string</feature><symbol> </symbol><symbol>(</symbol><local>pid</local><symbol>)</symbol>
			<tag>valid_phase_name</tag><symbol>:</symbol> <feature><location>../tracker/tracker.xml#f_valid_string</location>valid_string</feature><symbol> </symbol><symbol>(</symbol><local>phase_name</local><symbol>)</symbol>
			<tag>positive_capacity</tag><symbol>:</symbol> <local>capacity</local><dot>.</dot><feature><include>False</include>to_double</feature> <symbol>&gt;</symbol> <number>0.0</number>
			<tag>expected_materials_non_empty</tag><symbol>:</symbol> <local>expected_materials</local><dot>.</dot><feature><include>False</include>count</feature> <symbol>&gt;</symbol> <number>0</number>
		<keyword>local</keyword>
			<local>new_p</local><symbol>:</symbol> <class><location>../tracker/phase.xml</location>PHASE</class>
		<keyword>do</keyword>
			<keyword>create</keyword> <local>new_p</local><dot>.</dot><feature><location>../tracker/phase.xml#f_make</location>make</feature><symbol> </symbol><symbol>(</symbol><local>pid</local><symbol>,</symbol> <local>phase_name</local><symbol>,</symbol> <local>capacity</local><symbol>,</symbol> <local>expected_materials</local><symbol>)</symbol>
			<feature><location>../tracker/tracker.xml#f_phases</location>phases</feature><dot>.</dot><feature><include>False</include>extend</feature><symbol> </symbol><symbol>(</symbol><local>new_p</local><symbol>,</symbol> <local>pid</local><symbol>)</symbol>
			<feature><location>../tracker/tracker.xml#f_sorted_phases</location>sorted_phases</feature><dot>.</dot><feature><include>False</include>extend</feature><symbol> </symbol><symbol>(</symbol><local>new_p</local><symbol>)</symbol>
			<feature><location>../tracker/tracker.xml#f_set_error</location>set_error</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_msg</location>msg</feature><dot>.</dot><feature><location>../tracker/messages_access.xml#f_ok</location>Ok</feature><symbol>)</symbol>
		<keyword>end</keyword>

	<anchor>f_new_tracker</anchor><feature><location>../tracker/tracker.xml#f_new_tracker</location>new_tracker</feature> <symbol>(</symbol><local>max_p_rad</local><symbol>,</symbol> <local>max_c_rad</local><symbol>:</symbol> <class><location>../mathmodels/value.xml</location>VALUE</class><symbol>)</symbol>
		<keyword>require</keyword>
			<tag>positive_values</tag><symbol>:</symbol> <local>max_p_rad</local><dot>.</dot><feature><location>../mathmodels/value.xml#f_as_double</location>as_double</feature> <symbol>&gt;=</symbol> <number>0.0</number> <keyword>and then</keyword> <local>max_c_rad</local><dot>.</dot><feature><location>../mathmodels/value.xml#f_as_double</location>as_double</feature> <symbol>&gt;=</symbol> <number>0.0</number>
			<tag>tracker_not_active</tag><symbol>:</symbol> <keyword>not</keyword> <feature><location>../tracker/tracker.xml#f_is_active</location>is_active</feature>
		<keyword>do</keyword>
			<feature><location>../tracker/tracker.xml#f_set_error</location>set_error</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_msg</location>msg</feature><dot>.</dot><feature><location>../tracker/messages_access.xml#f_ok</location>Ok</feature><symbol>)</symbol>
			<feature><location>../tracker/tracker.xml#f_max_phase_rad</location>max_phase_rad</feature> <symbol>:=</symbol> <local>max_p_rad</local>
			<feature><location>../tracker/tracker.xml#f_max_cont_rad</location>max_cont_rad</feature> <symbol>:=</symbol> <local>max_c_rad</local>
			<feature><location>../tracker/tracker.xml#f_set_error</location>set_error</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_msg</location>msg</feature><dot>.</dot><feature><location>../tracker/messages_access.xml#f_ok</location>Ok</feature><symbol>)</symbol>
		<keyword>end</keyword>

	<anchor>f_new_container</anchor><feature><location>../tracker/tracker.xml#f_new_container</location>new_container</feature> <symbol>(</symbol><local>cid</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>;</symbol> <local>cont_spec</local><symbol>:</symbol> <class><include>False</include>TUPLE</class> <symbol>[</symbol><local>m</local><symbol>:</symbol> <class><include>False</include>INTEGER_64</class><symbol>;</symbol> <local>rad</local><symbol>:</symbol> <class><location>../mathmodels/value.xml</location>VALUE</class><symbol>]</symbol><symbol>;</symbol> <local>pid</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>)</symbol>
		<keyword>require</keyword>
			<tag>cont_not_in_use</tag><symbol>:</symbol> <keyword>not</keyword> <feature><location>../tracker/tracker.xml#f_cid_exists</location>cid_exists</feature><symbol> </symbol><symbol>(</symbol><local>cid</local><symbol>)</symbol>
		<keyword>local</keyword>
			<local>cont</local><symbol>:</symbol> <class><location>../tracker/phase_container.xml</location>PHASE_CONTAINER</class>
		<keyword>do</keyword>
			<keyword>create</keyword> <local>cont</local><dot>.</dot><feature><location>../tracker/phase_container.xml#f_make</location>make</feature><symbol> </symbol><symbol>(</symbol><local>cid</local><symbol>,</symbol> <local>cont_spec</local><dot>.</dot><local>m</local><symbol>,</symbol> <local>cont_spec</local><dot>.</dot><local>rad</local><symbol>,</symbol> <local>pid</local><symbol>)</symbol>
			<keyword>if</keyword> <keyword>attached</keyword> <feature><location>../tracker/tracker.xml#f_phases</location>phases</feature> <symbol>[</symbol><local>pid</local><symbol>]</symbol> <keyword>as</keyword> p <keyword>then</keyword>
				<local>p</local><dot>.</dot><feature><location>../tracker/phase.xml#f_add_container</location>add_container</feature><symbol> </symbol><symbol>(</symbol><local>cont</local><symbol>)</symbol>
				<feature><location>../tracker/tracker.xml#f_sorted_conts</location>sorted_conts</feature><dot>.</dot><feature><include>False</include>extend</feature><symbol> </symbol><symbol>(</symbol><local>cont</local><symbol>)</symbol>
				<feature><location>../tracker/tracker.xml#f_set_error</location>set_error</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_msg</location>msg</feature><dot>.</dot><feature><location>../tracker/messages_access.xml#f_ok</location>Ok</feature><symbol>)</symbol>
			<keyword>end</keyword>
		<keyword>end</keyword>

	<anchor>f_remove_phase</anchor><feature><location>../tracker/tracker.xml#f_remove_phase</location>remove_phase</feature> <symbol>(</symbol><local>phase_id</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>)</symbol>
			<comment>--</comment><comment> removes a phase from the tracker</comment>
			<comment>--</comment><comment>	require</comment>
			<comment>--</comment><comment>		phase_exists: get_phases.has (phase_id)</comment>
		<keyword>do</keyword>
			<keyword>if</keyword> <keyword>attached</keyword> <feature><location>../tracker/tracker.xml#f_phases</location>phases</feature> <symbol>[</symbol><local>phase_id</local><symbol>]</symbol> <keyword>as</keyword> p <keyword>then</keyword>
				<feature><location>../tracker/tracker.xml#f_sorted_phases</location>sorted_phases</feature><dot>.</dot><feature><include>False</include>prune_all</feature><symbol> </symbol><symbol>(</symbol><local>p</local><symbol>)</symbol>
			<keyword>end</keyword>
			<feature><location>../tracker/tracker.xml#f_phases</location>phases</feature><dot>.</dot><feature><include>False</include>remove</feature><symbol> </symbol><symbol>(</symbol><local>phase_id</local><symbol>)</symbol>
			<feature><location>../tracker/tracker.xml#f_set_error</location>set_error</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_msg</location>msg</feature><dot>.</dot><feature><location>../tracker/messages_access.xml#f_ok</location>Ok</feature><symbol>)</symbol>
		<keyword>ensure</keyword>
			<tag>phase_removed</tag><symbol>:</symbol> <keyword>not</keyword> <symbol>(</symbol><feature><location>../tracker/tracker.xml#f_phases</location>phases</feature><dot>.</dot><feature><include>False</include>has_key</feature><symbol> </symbol><symbol>(</symbol><local>phase_id</local><symbol>)</symbol><symbol>)</symbol>
		<keyword>end</keyword>

	<anchor>f_remove_container</anchor><feature><location>../tracker/tracker.xml#f_remove_container</location>remove_container</feature> <symbol>(</symbol><local>cid</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>)</symbol>
			<comment>--</comment><comment> removes a container from the tracker</comment>
		<keyword>local</keyword>
			<local>cur_phase</local><symbol>:</symbol> <class><location>../tracker/phase.xml</location>PHASE</class>
			<local>cur_cont</local><symbol>:</symbol> <class><location>../tracker/phase_container.xml</location>PHASE_CONTAINER</class>
		<keyword>do</keyword>
			<local>cur_phase</local> <symbol>:=</symbol> <feature><location>../tracker/tracker.xml#f_get_phase_containing_cid</location>get_phase_containing_cid</feature><symbol> </symbol><symbol>(</symbol><local>cid</local><symbol>)</symbol>
			<local>cur_cont</local> <symbol>:=</symbol> <feature><location>../tracker/tracker.xml#f_get_container</location>get_container</feature><symbol> </symbol><symbol>(</symbol><local>cid</local><symbol>)</symbol>
			<keyword>if</keyword> <keyword>attached</keyword> <local>cur_phase</local> <keyword>as</keyword> p <keyword>and then</keyword> <keyword>attached</keyword> <local>cur_cont</local> <keyword>as</keyword> c <keyword>then</keyword>
				<feature><location>../tracker/tracker.xml#f_sorted_conts</location>sorted_conts</feature><dot>.</dot><feature><include>False</include>prune_all</feature><symbol> </symbol><symbol>(</symbol><local>c</local><symbol>)</symbol>
				<local>p</local><dot>.</dot><feature><location>../tracker/phase.xml#f_remove_container</location>remove_container</feature><symbol> </symbol><symbol>(</symbol><local>cid</local><symbol>)</symbol>
			<keyword>end</keyword>
			<feature><location>../tracker/tracker.xml#f_set_error</location>set_error</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_msg</location>msg</feature><dot>.</dot><feature><location>../tracker/messages_access.xml#f_ok</location>Ok</feature><symbol>)</symbol>
		<keyword>end</keyword>

	<anchor>f_move_container</anchor><feature><location>../tracker/tracker.xml#f_move_container</location>move_container</feature> <symbol>(</symbol><local>cid</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>;</symbol> <local>pid1</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>;</symbol> <local>pid2</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>)</symbol>
			<comment>--</comment><comment> moves a container from a source phase to a target phase</comment>
		<keyword>local</keyword>
			<local>temp_cont</local><symbol>:</symbol> <class><location>../tracker/phase_container.xml</location>PHASE_CONTAINER</class>
		<keyword>do</keyword>
			<keyword>if</keyword> <keyword>attached</keyword> <feature><location>../tracker/tracker.xml#f_get_container</location>get_container</feature><symbol> </symbol><symbol>(</symbol><local>cid</local><symbol>)</symbol> <keyword>as</keyword> cont <keyword>and then</keyword> <keyword>attached</keyword> <feature><location>../tracker/tracker.xml#f_phases</location>phases</feature> <symbol>[</symbol><local>pid1</local><symbol>]</symbol> <keyword>as</keyword> p1 <keyword>and then</keyword> <keyword>attached</keyword> <feature><location>../tracker/tracker.xml#f_phases</location>phases</feature> <symbol>[</symbol><local>pid2</local><symbol>]</symbol> <keyword>as</keyword> p2 <keyword>then</keyword>
				<local>temp_cont</local> <symbol>:=</symbol> <local>cont</local>
				<local>p1</local><dot>.</dot><feature><location>../tracker/phase.xml#f_remove_container</location>remove_container</feature><symbol> </symbol><symbol>(</symbol><local>cid</local><symbol>)</symbol>
				<local>p2</local><dot>.</dot><feature><location>../tracker/phase.xml#f_add_container</location>add_container</feature><symbol> </symbol><symbol>(</symbol><local>temp_cont</local><symbol>)</symbol>
				<local>cont</local><dot>.</dot><feature><location>../tracker/phase_container.xml#f_set_pid</location>set_pid</feature><symbol> </symbol><symbol>(</symbol><local>pid2</local><symbol>)</symbol>
			<keyword>end</keyword>
			<feature><location>../tracker/tracker.xml#f_set_error</location>set_error</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_msg</location>msg</feature><dot>.</dot><feature><location>../tracker/messages_access.xml#f_ok</location>Ok</feature><symbol>)</symbol>
		<keyword>ensure</keyword>
			<tag>container_exists</tag><symbol>:</symbol> <feature><location>../tracker/tracker.xml#f_cid_exists</location>cid_exists</feature><symbol> </symbol><symbol>(</symbol><local>cid</local><symbol>)</symbol>
			<tag>cid_in_phase_attached</tag><symbol>:</symbol> <keyword>attached</keyword> <feature><location>../tracker/tracker.xml#f_get_phase_containing_cid</location>get_phase_containing_cid</feature><symbol> </symbol><symbol>(</symbol><local>cid</local><symbol>)</symbol> <keyword>as</keyword> pc
			<tag>cont_is_in_target_phase</tag><symbol>:</symbol> <local>pc</local><dot>.</dot><feature><location>../tracker/phase.xml#f_get_pid</location>get_pid</feature> <symbol>~</symbol> <local>pid2</local>
		<keyword>end</keyword>

	<anchor>f_store_error</anchor><feature><location>../tracker/tracker.xml#f_store_error</location>store_error</feature> <symbol>(</symbol><local>new_msg</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>)</symbol>
			<comment>--</comment><comment> stores the state of error into history</comment>
		<keyword>local</keyword>
			<local>e</local><symbol>:</symbol> <class><location>../tracker/error.xml</location>ERROR</class>
		<keyword>do</keyword>
			<feature><location>../tracker/tracker.xml#f_error</location>error</feature> <symbol>:=</symbol> <local>new_msg</local>
			<keyword>create</keyword> <local>e</local><dot>.</dot><feature><location>../tracker/error.xml#f_make</location>make</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_error</location>error</feature><symbol>)</symbol>
			<feature><location>../tracker/tracker.xml#f_history</location>history</feature><dot>.</dot><feature><location>../tracker/history.xml#f_add_to_record</location>add_to_record</feature><symbol> </symbol><symbol>(</symbol><local>e</local><symbol>)</symbol>
		<keyword>end</keyword>
	
<keyword>feature</keyword> <comment>--</comment><comment> setters</comment>

	<anchor>f_set_error</anchor><feature><location>../tracker/tracker.xml#f_set_error</location>set_error</feature> <symbol>(</symbol><local>init_msg</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>)</symbol>
		<keyword>do</keyword>
			<feature><location>../tracker/tracker.xml#f_error</location>error</feature> <symbol>:=</symbol> <local>init_msg</local>
		<keyword>end</keyword>

	<anchor>f_set_state</anchor><feature><location>../tracker/tracker.xml#f_set_state</location>set_state</feature> <symbol>(</symbol><local>new_state</local><symbol>:</symbol> <class><include>False</include>INTEGER_32</class><symbol>)</symbol>
			<comment>--</comment><comment> sets both the state and the cursor state to state</comment>
		<keyword>do</keyword>
			<feature><location>../tracker/tracker.xml#f_state</location>state</feature> <symbol>:=</symbol> <local>new_state</local>
			<feature><location>../tracker/tracker.xml#f_set_cursor_state</location>set_cursor_state</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_state</location>state</feature><symbol>)</symbol>
		<keyword>end</keyword>

	<anchor>f_set_cursor_state</anchor><feature><location>../tracker/tracker.xml#f_set_cursor_state</location>set_cursor_state</feature> <symbol>(</symbol><local>cur_state</local><symbol>:</symbol> <class><include>False</include>INTEGER_32</class><symbol>)</symbol>
			<comment>--</comment><comment>		require</comment>
			<comment>--</comment><comment>			cursor_state_not_over: cur_state &lt;= get_state</comment>
		<keyword>do</keyword>
			<feature><location>../tracker/tracker.xml#f_cursor_state</location>cursor_state</feature> <symbol>:=</symbol> <local>cur_state</local>
		<keyword>end</keyword>
	
<keyword>feature</keyword> <comment>--</comment><comment> getter</comment>

	<anchor>f_get_phases</anchor><feature><location>../tracker/tracker.xml#f_get_phases</location>get_phases</feature><symbol>:</symbol> <class><include>False</include>STRING_TABLE</class> <symbol>[</symbol><class><location>../tracker/phase.xml</location>PHASE</class><symbol>]</symbol>
		<keyword>do</keyword>
			<keyword>Result</keyword> <symbol>:=</symbol> <feature><location>../tracker/tracker.xml#f_phases</location>phases</feature>
		<keyword>end</keyword>

	<anchor>f_get_history</anchor><feature><location>../tracker/tracker.xml#f_get_history</location>get_history</feature><symbol>:</symbol> <class><location>../tracker/history.xml</location>HISTORY</class>
		<keyword>do</keyword>
			<keyword>Result</keyword> <symbol>:=</symbol> <feature><location>../tracker/tracker.xml#f_history</location>history</feature>
		<keyword>end</keyword>

	<anchor>f_get_state</anchor><feature><location>../tracker/tracker.xml#f_get_state</location>get_state</feature><symbol>:</symbol> <class><include>False</include>INTEGER_32</class>
		<keyword>do</keyword>
			<keyword>Result</keyword> <symbol>:=</symbol> <feature><location>../tracker/tracker.xml#f_state</location>state</feature>
		<keyword>end</keyword>

	<anchor>f_get_cursor_state</anchor><feature><location>../tracker/tracker.xml#f_get_cursor_state</location>get_cursor_state</feature><symbol>:</symbol> <class><include>False</include>INTEGER_32</class>
		<keyword>do</keyword>
			<keyword>Result</keyword> <symbol>:=</symbol> <feature><location>../tracker/tracker.xml#f_cursor_state</location>cursor_state</feature>
		<keyword>end</keyword>

	<anchor>f_get_max_cont_rad</anchor><feature><location>../tracker/tracker.xml#f_get_max_cont_rad</location>get_max_cont_rad</feature><symbol>:</symbol> <class><location>../mathmodels/value.xml</location>VALUE</class>
		<keyword>do</keyword>
			<keyword>Result</keyword> <symbol>:=</symbol> <feature><location>../tracker/tracker.xml#f_max_cont_rad</location>max_cont_rad</feature>
		<keyword>end</keyword>

	<anchor>f_get_max_phase_rad</anchor><feature><location>../tracker/tracker.xml#f_get_max_phase_rad</location>get_max_phase_rad</feature><symbol>:</symbol> <class><location>../mathmodels/value.xml</location>VALUE</class>
		<keyword>do</keyword>
			<keyword>Result</keyword> <symbol>:=</symbol> <feature><location>../tracker/tracker.xml#f_max_phase_rad</location>max_phase_rad</feature>
		<keyword>end</keyword>
	
<keyword>feature</keyword> <comment>--</comment><comment> error checks</comment>

	<anchor>f_is_active</anchor><feature><location>../tracker/tracker.xml#f_is_active</location>is_active</feature><symbol>:</symbol> <class><include>False</include>BOOLEAN</class>
			<comment>--</comment><comment> are there any containers in the system</comment>
		<keyword>do</keyword>
			<keyword>Result</keyword> <symbol>:=</symbol> <feature><location>../tracker/tracker.xml#f_sorted_conts</location>sorted_conts</feature><dot>.</dot><feature><include>False</include>count</feature> <symbol>&gt;</symbol> <number>0</number>
		<keyword>end</keyword>

	<anchor>f_valid_string</anchor><feature><location>../tracker/tracker.xml#f_valid_string</location>valid_string</feature> <symbol>(</symbol><local>s</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>)</symbol><symbol>:</symbol> <class><include>False</include>BOOLEAN</class>
			<comment>--</comment><comment> does the string start with A-Z, a-z or 0-9?</comment>
		<keyword>do</keyword>
			<keyword>Result</keyword> <symbol>:=</symbol> <symbol>(</symbol><keyword>not</keyword> <local>s</local><dot>.</dot><feature><include>False</include>is_empty</feature><symbol>)</symbol> <keyword>and then</keyword> <symbol>(</symbol><local>s</local> <symbol>[</symbol><number>1</number><symbol>]</symbol><dot>.</dot><feature><include>False</include>is_alpha_numeric</feature><symbol>)</symbol>
		<keyword>end</keyword>

	<anchor>f_under_capacity</anchor><feature><location>../tracker/tracker.xml#f_under_capacity</location>under_capacity</feature> <symbol>(</symbol><local>pid</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>)</symbol><symbol>:</symbol> <class><include>False</include>BOOLEAN</class>
			<comment>--</comment><comment> can the phase handle another container?</comment>
		<keyword>require</keyword>
				<feature><location>../tracker/tracker.xml#f_get_phases</location>get_phases</feature><dot>.</dot><feature><include>False</include>has</feature><symbol> </symbol><symbol>(</symbol><local>pid</local><symbol>)</symbol>
		<keyword>do</keyword>
			<keyword>if</keyword> <keyword>attached</keyword> <feature><location>../tracker/tracker.xml#f_get_phases</location>get_phases</feature><dot>.</dot><feature><include>False</include>at</feature><symbol> </symbol><symbol>(</symbol><local>pid</local><symbol>)</symbol> <keyword>as</keyword> p <keyword>and</keyword> <keyword>attached</keyword> <feature><location>../tracker/tracker.xml#f_get_phases</location>get_phases</feature><dot>.</dot><feature><include>False</include>at</feature><symbol> </symbol><symbol>(</symbol><local>pid</local><symbol>)</symbol> <keyword>as</keyword> gp <keyword>then</keyword>
				<keyword>Result</keyword> <symbol>:=</symbol> <symbol>(</symbol><local>p</local><dot>.</dot><feature><location>../tracker/phase.xml#f_get_containers</location>get_containers</feature><dot>.</dot><feature><include>False</include>count</feature><symbol>)</symbol><dot>.</dot><feature><include>False</include>to_integer_64</feature> <symbol>&lt;</symbol> <symbol>(</symbol><local>gp</local><dot>.</dot><feature><location>../tracker/phase.xml#f_get_capacity</location>get_capacity</feature><symbol>)</symbol>
			<keyword>end</keyword>
		<keyword>end</keyword>

	<anchor>f_cont_gt_max_phase_rad</anchor><feature><location>../tracker/tracker.xml#f_cont_gt_max_phase_rad</location>cont_gt_max_phase_rad</feature> <symbol>(</symbol><local>rad</local><symbol>:</symbol> <class><location>../mathmodels/value.xml</location>VALUE</class><symbol>;</symbol> <local>pid</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>)</symbol><symbol>:</symbol> <class><include>False</include>BOOLEAN</class>
			<comment>--</comment><comment> is the total container radiation greater than the maximum phase radiation?</comment>
		<keyword>local</keyword>
			<local>sum</local><symbol>:</symbol> <class><location>../mathmodels/value.xml</location>VALUE</class>
		<keyword>do</keyword>
			<keyword>create</keyword> <local>sum</local><dot>.</dot><feature><location>../mathmodels/value.xml#f_make_from_int</location>make_from_int</feature><symbol> </symbol><symbol>(</symbol><number>0</number><symbol>)</symbol>
			<keyword>if</keyword> <keyword>attached</keyword> <feature><location>../tracker/tracker.xml#f_phases</location>phases</feature> <symbol>[</symbol><local>pid</local><symbol>]</symbol> <keyword>as</keyword> conts <keyword>then</keyword>
				<keyword>across</keyword>
					<local>conts</local><dot>.</dot><feature><location>../tracker/phase.xml#f_get_containers</location>get_containers</feature> <keyword>as</keyword> cc
				<keyword>loop</keyword>
					<local>sum</local> <symbol>:=</symbol> <local>sum</local> <symbol><location>../mathmodels/value.xml#f_plus</location>+</symbol> <local>cc</local><dot>.</dot><feature><include>False</include>item</feature><dot>.</dot><feature><location>../tracker/phase_container.xml#f_get_rad</location>get_rad</feature>
				<keyword>end</keyword>
				<local>sum</local> <symbol>:=</symbol> <local>sum</local> <symbol><location>../mathmodels/value.xml#f_plus</location>+</symbol> <local>rad</local>
				<keyword>if</keyword> <local>sum</local> <symbol>&gt;</symbol> <feature><location>../tracker/tracker.xml#f_max_phase_rad</location>max_phase_rad</feature> <keyword>then</keyword>
					<keyword>Result</keyword> <symbol>:=</symbol> <keyword>True</keyword>
				<keyword>else</keyword>
					<keyword>Result</keyword> <symbol>:=</symbol> <keyword>False</keyword>
				<keyword>end</keyword>
			<keyword>end</keyword>
		<keyword>end</keyword>

	<anchor>f_phase_expects_mat</anchor><feature><location>../tracker/tracker.xml#f_phase_expects_mat</location>phase_expects_mat</feature> <symbol>(</symbol><local>mat</local><symbol>:</symbol> <class><include>False</include>INTEGER_64</class><symbol>;</symbol> <local>pid</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>)</symbol><symbol>:</symbol> <class><include>False</include>BOOLEAN</class>
			<comment>--</comment><comment> does the phase expect this container material?</comment>
		<keyword>do</keyword>
			<keyword>Result</keyword> <symbol>:=</symbol> <keyword>False</keyword>
			<keyword>if</keyword> <keyword>attached</keyword> <feature><location>../tracker/tracker.xml#f_phases</location>phases</feature> <symbol>[</symbol><local>pid</local><symbol>]</symbol> <keyword>as</keyword> p <keyword>then</keyword>
				<keyword>across</keyword>
					<local>p</local><dot>.</dot><feature><location>../tracker/phase.xml#f_get_mats</location>get_mats</feature> <keyword>as</keyword> cm
				<keyword>loop</keyword>
					<keyword>if</keyword> <local>cm</local><dot>.</dot><feature><include>False</include>item</feature> <symbol>=</symbol> <local>mat</local> <keyword>then</keyword>
						<keyword>Result</keyword> <symbol>:=</symbol> <keyword>True</keyword>
					<keyword>end</keyword>
				<keyword>end</keyword>
			<keyword>end</keyword>
		<keyword>end</keyword>
	
<keyword>feature</keyword> <comment>--</comment><comment> error checks</comment>

	<anchor>f_cid_exists</anchor><feature><location>../tracker/tracker.xml#f_cid_exists</location>cid_exists</feature> <symbol>(</symbol><local>cid</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>)</symbol><symbol>:</symbol> <class><include>False</include>BOOLEAN</class>
		<keyword>do</keyword>
			<keyword>Result</keyword> <symbol>:=</symbol> <keyword>False</keyword>
			<keyword>across</keyword>
				<feature><location>../tracker/tracker.xml#f_phases</location>phases</feature> <keyword>as</keyword> p
			<keyword>loop</keyword>
				<keyword>Result</keyword> <symbol>:=</symbol> <keyword>Result</keyword> <keyword>or else</keyword> <symbol>(</symbol><local>p</local><dot>.</dot><feature><include>False</include>item</feature><dot>.</dot><feature><location>../tracker/phase.xml#f_get_containers</location>get_containers</feature><dot>.</dot><feature><include>False</include>has</feature><symbol> </symbol><symbol>(</symbol><local>cid</local><symbol>)</symbol><symbol>)</symbol>
			<keyword>end</keyword>
		<keyword>end</keyword>
	
<keyword>feature</keyword> <comment>--</comment><comment> queries</comment>

	<anchor>f_get_phase_containing_cid</anchor><feature><location>../tracker/tracker.xml#f_get_phase_containing_cid</location>get_phase_containing_cid</feature> <symbol>(</symbol><local>cid</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>)</symbol><symbol>:</symbol> <keyword>detachable</keyword> <class><location>../tracker/phase.xml</location>PHASE</class>
		<keyword>do</keyword>
			<keyword>Result</keyword> <symbol>:=</symbol> <keyword>Void</keyword>
			<keyword>across</keyword>
				<feature><location>../tracker/tracker.xml#f_phases</location>phases</feature> <keyword>as</keyword> cursor
			<keyword>loop</keyword>
				<keyword>if</keyword> <local>cursor</local><dot>.</dot><feature><include>False</include>item</feature><dot>.</dot><feature><location>../tracker/phase.xml#f_get_containers</location>get_containers</feature><dot>.</dot><feature><include>False</include>has</feature><symbol> </symbol><symbol>(</symbol><local>cid</local><symbol>)</symbol> <keyword>then</keyword>
					<keyword>Result</keyword> <symbol>:=</symbol> <local>cursor</local><dot>.</dot><feature><include>False</include>item</feature>
				<keyword>end</keyword>
			<keyword>end</keyword>
		<keyword>end</keyword>

	<anchor>f_get_container</anchor><feature><location>../tracker/tracker.xml#f_get_container</location>get_container</feature> <symbol>(</symbol><local>cid</local><symbol>:</symbol> <class><include>False</include>STRING_8</class><symbol>)</symbol><symbol>:</symbol> <keyword>detachable</keyword> <class><location>../tracker/phase_container.xml</location>PHASE_CONTAINER</class>
		<keyword>do</keyword>
			<keyword>across</keyword>
				<feature><location>../tracker/tracker.xml#f_phases</location>phases</feature> <keyword>as</keyword> cursor
			<keyword>loop</keyword>
				<keyword>if</keyword> <local>cursor</local><dot>.</dot><feature><include>False</include>item</feature><dot>.</dot><feature><location>../tracker/phase.xml#f_get_containers</location>get_containers</feature><dot>.</dot><feature><include>False</include>has</feature><symbol> </symbol><symbol>(</symbol><local>cid</local><symbol>)</symbol> <keyword>then</keyword>
					<keyword>Result</keyword> <symbol>:=</symbol> <local>cursor</local><dot>.</dot><feature><include>False</include>item</feature><dot>.</dot><feature><location>../tracker/phase.xml#f_get_containers</location>get_containers</feature> <symbol>[</symbol><local>cid</local><symbol>]</symbol>
				<keyword>end</keyword>
			<keyword>end</keyword>
		<keyword>end</keyword>

	<anchor>f_out</anchor><feature><location>../tracker/tracker.xml#f_out</location>out</feature><symbol>:</symbol> <class><include>False</include>STRING_8</class>
			<comment>--</comment><comment> New string containing terse printable representation</comment>
			<comment>--</comment><comment> of current object</comment>
		<keyword>local</keyword>
			<local>stwl_c</local><symbol>:</symbol> <class><location>../tracker/stwl_out.xml</location>STWL_OUT</class> <symbol>[</symbol><class><location>../tracker/phase_container.xml</location>PHASE_CONTAINER</class><symbol>]</symbol>
			<local>stwl_p</local><symbol>:</symbol> <class><location>../tracker/stwl_out.xml</location>STWL_OUT</class> <symbol>[</symbol><class><location>../tracker/phase.xml</location>PHASE</class><symbol>]</symbol>
			<local>er_msg</local><symbol>:</symbol> <class><location>../tracker/messages_access.xml</location>MESSAGES_ACCESS</class>
		<keyword>do</keyword>
			<keyword>create</keyword> <keyword>Result</keyword><dot>.</dot><feature><include>False</include>make_from_string</feature><symbol> </symbol><symbol>(</symbol>&quot;  state &quot;<symbol>)</symbol>
			<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append_integer</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_state</location>state</feature><symbol>)</symbol>
			<keyword>if</keyword> <feature><location>../tracker/tracker.xml#f_cursor_state</location>cursor_state</feature> <symbol>/=</symbol> <feature><location>../tracker/tracker.xml#f_state</location>state</feature> <keyword>then</keyword>
				<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append</feature><symbol> </symbol><symbol>(</symbol>&quot; (to &quot;<symbol>)</symbol>
				<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append_integer</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_cursor_state</location>cursor_state</feature><symbol>)</symbol>
				<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append</feature><symbol> </symbol><symbol>(</symbol>&quot;)&quot;<symbol>)</symbol>
			<keyword>end</keyword>
			<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append</feature><symbol> </symbol><symbol>(</symbol>&quot; &quot; <symbol>+</symbol> <feature><location>../tracker/tracker.xml#f_error</location>error</feature><symbol>)</symbol>
			<keyword>if</keyword> <symbol>(</symbol><feature><location>../tracker/tracker.xml#f_error</location>error</feature> <symbol>=</symbol> <local>er_msg</local><dot>.</dot><feature><location>../tracker/messages_access.xml#f_ok</location>Ok</feature><symbol>)</symbol> <keyword>then</keyword>
				<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append</feature><symbol> </symbol><symbol>(</symbol>&quot;%N  max_phase_radiation: &quot;<symbol>)</symbol>
				<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_max_phase_rad</location>max_phase_rad</feature><dot>.</dot><feature><location>../mathmodels/value.xml#f_out</location>out</feature><symbol>)</symbol>
				<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append</feature><symbol> </symbol><symbol>(</symbol>&quot;, max_container_radiation: &quot;<symbol>)</symbol>
				<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_max_cont_rad</location>max_cont_rad</feature><dot>.</dot><feature><location>../mathmodels/value.xml#f_out</location>out</feature><symbol>)</symbol>
				<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append</feature><symbol> </symbol><symbol>(</symbol>&quot;%N  phases: pid-&gt;name:capacity,count,radiation&quot;<symbol>)</symbol>
				<keyword>if</keyword> <keyword>not</keyword> <feature><location>../tracker/tracker.xml#f_sorted_phases</location>sorted_phases</feature><dot>.</dot><feature><include>False</include>is_empty</feature> <keyword>then</keyword>
					<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append</feature><symbol> </symbol><symbol>(</symbol>&quot;%N&quot;<symbol>)</symbol>
					<keyword>create</keyword> <local>stwl_p</local><dot>.</dot><feature><location>../tracker/stwl_out.xml#f_make</location>make</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_sorted_phases</location>sorted_phases</feature><symbol>)</symbol>
					<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append</feature><symbol> </symbol><symbol>(</symbol><local>stwl_p</local><dot>.</dot><feature><location>../tracker/stwl_out.xml#f_out</location>out</feature><symbol>)</symbol>
				<keyword>end</keyword>
				<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append</feature><symbol> </symbol><symbol>(</symbol>&quot;%N  containers: cid-&gt;pid-&gt;material,radioactivity&quot;<symbol>)</symbol>
				<keyword>if</keyword> <keyword>not</keyword> <feature><location>../tracker/tracker.xml#f_sorted_conts</location>sorted_conts</feature><dot>.</dot><feature><include>False</include>is_empty</feature> <keyword>then</keyword>
					<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append</feature><symbol> </symbol><symbol>(</symbol>&quot;%N&quot;<symbol>)</symbol>
					<keyword>create</keyword> <local>stwl_c</local><dot>.</dot><feature><location>../tracker/stwl_out.xml#f_make</location>make</feature><symbol> </symbol><symbol>(</symbol><feature><location>../tracker/tracker.xml#f_sorted_conts</location>sorted_conts</feature><symbol>)</symbol>
					<keyword>Result</keyword><dot>.</dot><feature><include>False</include>append</feature><symbol> </symbol><symbol>(</symbol><local>stwl_c</local><dot>.</dot><feature><location>../tracker/stwl_out.xml#f_out</location>out</feature><symbol>)</symbol>
				<keyword>end</keyword>
			<keyword>end</keyword>
		<keyword>end</keyword>
	
<keyword>feature</keyword> <comment>--</comment><comment> misc</comment>

	<anchor>f_reset</anchor><feature><location>../tracker/tracker.xml#f_reset</location>reset</feature>
			<comment>--</comment><comment> Reset model state.</comment>
		<keyword>do</keyword>
			<feature><location>../tracker/tracker.xml#f_make</location>make</feature>
		<keyword>end</keyword>
	
<keyword>end</keyword> <comment>--</comment> <comment>class </comment><class><location>../tracker/tracker.xml</location>TRACKER</class></system>

